
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content=#58b77a>
<title>Brushes &amp; Keys</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Nan Chen">
<meta name="keywords" content="javascript web-devlopement photography">
<meta name="description" content="Personal blog tech & life">

<script id="hexo-configurations">
  var CONFIG = {
    root: '/',
    theme: 'lx',
    version: '0.3.9',
    localsearch:{
      "enable": false,
      "trigger": "auto",
      "top_n_per_article": 1,
      "unescape": false,
      "preload": false
      },
    path: '-'
  };
</script>

<link rel="shortcut icon" href="/bg.png">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/css/main.min.css">
<link rel="stylesheet" href="/css/mycss.css">
<style type="text/css">
  pre,
  code {
    font-family: 'Hind Siliguri',
      monospace;
  }

  html {
    font-family: sans-serif;
  }

  body {
    font-family: sans-serif;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  figure {
    font-family: Hind Siliguri;
  }

  .menu-container {
    font-family: sans-serif;
  }

</style>

<script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.jside.menu.js"></script>
<script>
  $(document).ready(function () {
    $(".menu-container").jSideMenu({
      jSidePosition: "position-right",
      jSideSticky: true,
      jSideSkin: "greenish",
    });
  });

</script>

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Hind Siliguri:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="page">

<div id="lx-aside" style="background-image: url(https://images.unsplash.com/photo-1557853197-aefb550b6fdc?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80)">
  <div class="overlay">
    <div class="featured">
      <div class="avatar"><a href="/"><img src="https://avatars0.githubusercontent.com/u/26827800?s=460&u=59259f6cb361b7fba376e3ae0c589ccc1639c8b4&v=4"></a></div>
      <span>Nan Chen</span>
      <h1>Brushes & Keys</h1>
      <span>Coding-Baking Photos-Paints </span>
    <div class="social-links">
  <a href="https://github.com/southchen" target="_blank"><i
      class="fa fa-github fa-fw"></i></a>
  <a href="https://instagram.com/divetothesea" target="_blank"><i
      class="fa fa-instagram fa-fw"></i></a>
  <a href="https://www.behance.net/southchen" target="_blank"><i
      class="fa fa-behance fa-fw"></i></a>
</div>

  </div>
  </div>
</div>

<div id="lx-main-content">
  <div class="lx-post"> 

  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2020/05/21/Template-for-Divided-Conquer-Algorithm/">Template for Divided Conquer Algorithm</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2020-05-21</span>
      <p><div class="note warning">
            <h3 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h3><p>This article is originally based on my understanding of this concept. No guarantee on the accuracy.ðŸ˜…</p>
          </div>

<p><strong><code>Template:</code></strong></p>
<ul>
<li><p>1.base case</p>
</li>
<li><p>2.split to smaller sacle </p>
<p>(directly slice from the array otherwise maintain the index, and dynamically updated every call)</p>
</li>
<li><p>3.recursion</p>
</li>
<li><p>4.combination </p>
<p>(define the combination function and pass the returned value from recursion as parameter)</p>
</li>
</ul>
<p>Letâ€™s see the examples from easy to moderate</p>
<h2 id="ðŸŒŸ-Search-the-max-amp-min-value"><a href="#ðŸŒŸ-Search-the-max-amp-min-value" class="headerlink" title="ðŸŒŸ Search the max&amp;min value"></a>ðŸŒŸ Search the max&amp;min value</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">searchMaxMin</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//the base case</span></span><br><span class="line">        <span class="keyword">if</span> (arr.length &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> [<span class="built_in">Math</span>.max(...arr), <span class="built_in">Math</span>.min(...arr)];</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">//split</span></span><br><span class="line">        <span class="keyword">var</span> mid = arr.length / <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">let</span> left = arr.slice(<span class="number">0</span>, mid + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> right = arr.slice(mid + <span class="number">1</span>, arr.length);</span><br><span class="line">      <span class="comment">//recursion</span></span><br><span class="line">        <span class="keyword">var</span> sortedLeft = searchMaxMin(left);</span><br><span class="line">        <span class="keyword">var</span> sortedRight = searchMaxMin(right);</span><br><span class="line"><span class="comment">//combination function</span></span><br><span class="line">         <span class="keyword">const</span> combine = <span class="function">(<span class="params">left, right</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> result = [];</span><br><span class="line">          result[<span class="number">0</span>] = left[<span class="number">0</span>] &gt; right[<span class="number">0</span>] ? left[<span class="number">0</span>] : right[<span class="number">0</span>];</span><br><span class="line">          result[<span class="number">1</span>] = left[<span class="number">1</span>] &gt; right[<span class="number">1</span>] ? right[<span class="number">1</span>] : left[<span class="number">1</span>];</span><br><span class="line">          <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="comment">//combine the returned value</span></span><br><span class="line">        <span class="keyword">return</span> combine(sortedLeft, sortedRight);</span><br><span class="line">      &#125;</span><br><span class="line">searchMaxMin([<span class="number">11</span>,<span class="number">2</span>,<span class="number">34</span>,<span class="number">0</span>,<span class="number">55</span>,<span class="number">11</span>])</span><br></pre></td></tr></table></figure>



<h2 id="ðŸŒŸðŸŒŸ-Merge-Sorting"><a href="#ðŸŒŸðŸŒŸ-Merge-Sorting" class="headerlink" title="ðŸŒŸðŸŒŸ Merge Sorting"></a>ðŸŒŸðŸŒŸ Merge Sorting</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeSort=<span class="function"><span class="params">arr</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//the edge case</span></span><br><span class="line">    <span class="keyword">if</span>(arr.length&lt;<span class="number">2</span>) <span class="keyword">return</span> arr;</span><br><span class="line">     <span class="comment">//split into smaller pieces</span></span><br><span class="line">    <span class="keyword">let</span> mid=<span class="built_in">Math</span>.floor(arr.length/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">let</span> left=arr.slice(<span class="number">0</span>,mid),right=arr.slice(mid);</span><br><span class="line">   <span class="comment">//recursion</span></span><br><span class="line">    <span class="keyword">let</span> sortedLeft = mergeSort(left),sortedRight=(mergeSort(right));</span><br><span class="line">    <span class="comment">//combination function</span></span><br><span class="line">    <span class="keyword">const</span> merge=<span class="function">(<span class="params">left,right</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> res=[];</span><br><span class="line">    <span class="keyword">while</span>(left.length&amp;&amp;right.length)&#123;</span><br><span class="line">        <span class="keyword">if</span>(left[<span class="number">0</span>]&lt;=right[<span class="number">0</span>])&#123;</span><br><span class="line">            res.push(left.shift());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.push(right.shift());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(left.length)&#123;</span><br><span class="line">        res.push(left.shift());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(right.length)&#123;</span><br><span class="line">        res.push(right.shift());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="comment">//combine the returned value</span></span><br><span class="line">    <span class="keyword">return</span> merge(sortedLeft,sortedRight);</span><br><span class="line">&#125;;</span><br><span class="line">mergeSort([<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<p>The call-stack would run in this sequence:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">merge(mergesort(<span class="number">3</span>,<span class="number">1</span>),mergersort(<span class="number">5</span>,<span class="number">0</span>,<span class="number">2</span>))</span><br><span class="line">merge(mergesort(<span class="number">3</span>),mergersort(<span class="number">1</span>))</span><br><span class="line">merge(left<span class="number">-3</span>,right<span class="number">-1</span>)</span><br><span class="line">merge(mergesort(<span class="number">5</span>),mergersort(<span class="number">0</span>,<span class="number">2</span>))</span><br><span class="line">merge(mergesort(<span class="number">0</span>),mergersort(<span class="number">2</span>))</span><br><span class="line">merge(left<span class="number">-0</span>,right<span class="number">-2</span>)</span><br><span class="line">merge(left<span class="number">-5</span>,right<span class="number">-0</span>,<span class="number">2</span>)</span><br><span class="line">merge(left<span class="number">-1</span>,<span class="number">3</span>,right<span class="number">-0</span>,<span class="number">2</span>,<span class="number">5</span>)</span><br></pre></td></tr></table></figure>



<h2 id="ðŸŒŸðŸŒŸ-Quick-Sorting"><a href="#ðŸŒŸðŸŒŸ-Quick-Sorting" class="headerlink" title="ðŸŒŸðŸŒŸ Quick Sorting"></a>ðŸŒŸðŸŒŸ Quick Sorting</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quick</span>(<span class="params">nums</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//the base case</span></span><br><span class="line">        <span class="keyword">if</span> (nums.length &lt;= <span class="number">1</span>) <span class="keyword">return</span> nums;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">let</span> mid = <span class="built_in">Math</span>.floor(nums.length / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">let</span> pivot = nums.splice(mid, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> left = [],</span><br><span class="line">          right = [];</span><br><span class="line">    <span class="comment">//break into two smaller array;</span></span><br><span class="line">        <span class="keyword">for</span> (num <span class="keyword">of</span> nums) &#123;</span><br><span class="line">          <span class="keyword">if</span> (num &lt; pivot) left.push(num);</span><br><span class="line">          <span class="keyword">if</span> (num &gt;= pivot) right.push(num);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//recursively pass the smaller sacle</span></span><br><span class="line">    <span class="keyword">let</span> sortedLeft =quick(left); </span><br><span class="line">    <span class="keyword">let</span> sortedRight = quick(right);</span><br><span class="line">    <span class="comment">//combine the returned result</span></span><br><span class="line">   <span class="keyword">return</span> [...sortedLeft, ...pivot, ...sortedRight]; </span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>



<h2 id="ðŸŒŸðŸŒŸ-169-Majority-Element"><a href="#ðŸŒŸðŸŒŸ-169-Majority-Element" class="headerlink" title="ðŸŒŸðŸŒŸ 169. Majority Element"></a>ðŸŒŸðŸŒŸ <a href="https://leetcode-cn.com/problems/majority-element/" target="_blank" rel="noopener">169. Majority Element</a></h2></p>
      <div class="post-button"><a class="btn" href="/2020/05/21/Template-for-Divided-Conquer-Algorithm/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2020/05/16/Understanding-Promise-part-2/">Understanding Promise part 2</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2020-05-16</span>
      <p><div class="note warning">
            <h3 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h3><p>This article is originally based on my understanding of this concept. No guarantee on the accuracy.ðŸ˜…</p>
          </div>

<p>â€˜The <strong><code>Promise</code></strong> object represents the eventual completion (or failure) of an asynchronous operation, and its resulting value.â€™</p>
<p>It was introduced to handle asynchronous operation like synchronous opeartion and avoid the callback hell.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">doSomething(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  doSomethingElse(result, <span class="function"><span class="keyword">function</span>(<span class="params">newResult</span>) </span>&#123;</span><br><span class="line">    doThirdThing(newResult, <span class="function"><span class="keyword">function</span>(<span class="params">finalResult</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Got the final result: '</span> + finalResult);</span><br><span class="line">    &#125;, failureCallback);</span><br><span class="line">  &#125;, failureCallback);</span><br><span class="line">&#125;, failureCallback);</span><br></pre></td></tr></table></figure>

<p>Common asynchronous-operation</p>
<ul>
<li>setTimeOut, setInterval</li>
<li>XHR request (fetch api)</li>
<li>Event Listening</li>
</ul>
<p>Thansk to promiseâ€™s .then() chaining, we can put the callback outsideï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">doSomething()</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> doSomethingElse(result))</span><br><span class="line">.then(<span class="function"><span class="params">newResult</span> =&gt;</span> doThirdThing(newResult))</span><br><span class="line">.then(<span class="function"><span class="params">finalResult</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Got the final result: <span class="subst">$&#123;finalResult&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(failureCallback);<span class="comment">//error handler for all above!</span></span><br></pre></td></tr></table></figure>

<p>*<em>This all based on modern API that returning a promise. That is to say, the promise chains starts with an API function  which returns a promise. *</em></p>
<p>We can create our own promise as well. Although itâ€™s not typical practice but it can be helpful to â€˜promisifyâ€™ some old callback-style API then chain the handler. </p>
<p>Letâ€™s look at how a promise is created. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">  <span class="comment">//executor which runs immediately/sync:</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sync!'</span>)</span><br><span class="line">  (res, rej)=&gt;&#123;</span><br><span class="line">    <span class="comment">// asynchronous operation. they will be put into the task queue</span></span><br><span class="line">    <span class="comment">//instead of returning something, it calls the callback as sideeffect to pass the result of asyn operation to res()/rej()</span></span><br><span class="line">    <span class="keyword">if</span>(somecodition) res(result); <span class="comment">//once the promise is settled the state won't be changed</span></span><br><span class="line">    rej(error)</span><br><span class="line">    <span class="comment">//then the res()/rej() can pass the result to the ousdie by chaining a .then()/.catch()</span></span><br><span class="line">&#125; </span><br><span class="line">  <span class="comment">//the construcor return the new promise obj (of course)</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>An example of wrapping a callback-style function with Promise:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wait = <span class="function"><span class="params">ms</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> setTimeout(resolve, ms));</span><br><span class="line"></span><br><span class="line">wait(<span class="number">10000</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> saySomething(<span class="string">"10 seconds"</span>)).catch(failureCallback);</span><br></pre></td></tr></table></figure></p>
      <div class="post-button"><a class="btn" href="/2020/05/16/Understanding-Promise-part-2/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2020/05/16/Understanding-Promise/">Understanding Promise part 1</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2020-05-16</span>
      <p><div class="note warning">
            <h3 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h3><p>This article is originally based on my understanding of this concept. No guarantee on the accuracy.ðŸ˜…</p>
          </div>

<p>Starting from a puzzle from <a href="https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html" target="_blank" rel="noopener">this article</a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> doSomethingElse();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  doSomethingElse();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">doSomething().then(doSomethingElse());</span><br><span class="line"></span><br><span class="line">doSomething().then(doSomethingElse);</span><br><span class="line"><span class="comment">//note doSomething() and doSomethingElse() return a resolved promise</span></span><br></pre></td></tr></table></figure>

<p>How would this code run?</p>
<h3 id="To-answer-this-puzzle-a-few-key-points-should-be-understood"><a href="#To-answer-this-puzzle-a-few-key-points-should-be-understood" class="headerlink" title="To answer this puzzle, a few key points should be understood:"></a>To answer this puzzle, a few key points should be understood:</h3><ul>
<li><p>.then(callback) would ounly be put into the <strong>task queue</strong> when the chained promise was settled (fullfulled/resolved or rejected).</p>
</li>
<li><p>.then(callback) would pass the value returned from the callback to following .then/.catch</p>
<ul>
<li><p>If there is no explicit return of the callback, returns undefined</p>
</li>
<li><p>If the callback returns a promise as well, the following .then()/.catch() would be thrown into the task queue, when itâ€™s settled. After the current stack is cleaned, they would be pushed to the stack (run the callback). Even a promise has already settled, the .then() still runs asynchronously. </p>
<ul>
<li><pre><code class="js"><span class="keyword">let</span> p = <span class="built_in">Promise</span>.resolve(<span class="string">'resolved already'</span>)
p.then(<span class="function"><span class="params">v</span>=&gt;</span>{<span class="built_in">console</span>.loe(<span class="string">'async result: '</span>=v)})
<span class="built_in">console</span>.log(<span class="string">'cleaning stack'</span>)
<span class="comment">//print 'cleaning stack' 'async result: resolved already'</span>
&lt;!--ï¿¼<span class="number">1</span>--&gt;</code></pre>
</li>
</ul>
</li>
<li><p>if the callback returns a normal variable, the variable would be passed, and the state will be set to <strong>resolved</strong>.</p>
<ul>
<li><p>a corner-case: if the callback returns obj which has a â€˜thenâ€™ method, the following then() would run as the code in â€˜thenâ€™ method.</p>
</li>
<li><pre><code class="js"> <span class="built_in">Promise</span>.resolve({<span class="attr">value</span>: <span class="number">1</span>,
                  then: <span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>{ <span class="comment">//the following then call this function</span>
                      <span class="built_in">console</span>.log(<span class="keyword">this</span>.value) <span class="comment">//print 1.</span>
                      resolve(<span class="string">'then method in object'</span>) 
                    <span class="comment">//resolve (or reject) function is a mustï¼Œotherwise the following then would not be called, pending</span>
                  })
           .then(<span class="function"><span class="params">value</span> =&gt;</span> {
              <span class="built_in">console</span>.log(<span class="string">'the result from pre .then:'</span> + value); <span class="comment">//print 'the result form pre .then: then method in object'</span>
              }
          })
&lt;!--ï¿¼<span class="number">2</span>--&gt;</code></pre>
</li>
</ul>
</li>
<li><p><strong>But actually this is against the design of Promise whose aim is to avoid callback style but to chain the async exceutor outside the previous one. So itâ€™d better update to this:</strong></p></li></ul></li></ul></p>
      <div class="post-button"><a class="btn" href="/2020/05/16/Understanding-Promise/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2020/05/13/Class-based-local-storage/">Class-based local storage</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2020-05-13</span>
      <p><h1 id="Class-based-local-storage"><a href="#Class-based-local-storage" class="headerlink" title="Class-based local storage"></a>Class-based local storage</h1><p>Sometimes when I was trying to build some small app, itâ€™s really not neccessary to connect the app to the cloud database like mongoDB. </p>
<p>A local json file would be enough.</p>
<p>It provide basic CURD api. And it also allows customed repo by extending a new class from it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//using node modules</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Repository</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(filename) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!filename) &#123; <span class="comment">//filename validator</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Creating a repository requires a filename'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.filename = filename;</span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">//if the repo exists, access it</span></span><br><span class="line">      fs.accessSync(<span class="keyword">this</span>.filename);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123; <span class="comment">//if the repo doesn't exist, create one</span></span><br><span class="line">      fs.writeFileSync(<span class="keyword">this</span>.filename, <span class="string">'[]'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> create(attrs) &#123; <span class="comment">//cerate new data entry</span></span><br><span class="line">    attrs.id = <span class="keyword">this</span>.randomId();</span><br><span class="line">    <span class="keyword">const</span> records = <span class="keyword">await</span> <span class="keyword">this</span>.getAll();</span><br><span class="line">    records.push(attrs);</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.writeAll(records);</span><br><span class="line">    <span class="keyword">return</span> attrs;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getAll() &#123; <span class="comment">//get all data</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(</span><br><span class="line">      <span class="keyword">await</span> fs.promises.readFile(<span class="keyword">this</span>.filename, &#123;</span><br><span class="line">        encoding: <span class="string">'utf8'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> writeAll(records) &#123;  <span class="comment">//write file</span></span><br><span class="line">    <span class="keyword">await</span> fs.promises.writeFile(</span><br><span class="line">      <span class="keyword">this</span>.filename,</span><br><span class="line">      <span class="built_in">JSON</span>.stringify(records, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  randomId() &#123; <span class="comment">//create an uniq id for each entry</span></span><br><span class="line">    <span class="keyword">return</span> crypto.randomBytes(<span class="number">4</span>).toString(<span class="string">'hex'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getOne(id) &#123; <span class="comment">//get single data</span></span><br><span class="line">    <span class="keyword">const</span> records = <span class="keyword">await</span> <span class="keyword">this</span>.getAll();</span><br><span class="line">    <span class="keyword">return</span> records.find(<span class="function"><span class="params">record</span> =&gt;</span> record.id === id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">delete</span>(id) &#123; <span class="comment">//delete</span></span><br><span class="line">    <span class="keyword">const</span> records = <span class="keyword">await</span> <span class="keyword">this</span>.getAll();</span><br><span class="line">    <span class="keyword">const</span> filteredRecords = records.filter(<span class="function"><span class="params">record</span> =&gt;</span> record.id !== id);</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.writeAll(filteredRecords);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> update(id, attrs) &#123; <span class="comment">//update data</span></span><br><span class="line">    <span class="keyword">const</span> records = <span class="keyword">await</span> <span class="keyword">this</span>.getAll();</span><br><span class="line">    <span class="keyword">const</span> record = records.find(<span class="function"><span class="params">record</span> =&gt;</span> record.id === id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!record) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Record with id <span class="subst">$&#123;id&#125;</span> not found`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Object</span>.assign(record, attrs);</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.writeAll(records);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getOneBy(filters) &#123; <span class="comment">//filter data</span></span><br><span class="line">    <span class="keyword">const</span> records = <span class="keyword">await</span> <span class="keyword">this</span>.getAll();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> record <span class="keyword">of</span> records) &#123;</span><br><span class="line">      <span class="keyword">let</span> found = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> filters) &#123;</span><br><span class="line">        <span class="keyword">if</span> (record[key] !== filters[key]) &#123;</span><br><span class="line">          found = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (found) &#123;</span><br><span class="line">        <span class="keyword">return</span> record;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>A user repo:</p></p>
      <div class="post-button"><a class="btn" href="/2020/05/13/Class-based-local-storage/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2020/04/29/Closure/">A visual way to learn Closure</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2020-04-29</span>
      <p><div class="note warning">
            <h3 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h3><p>This article is originally based on my understanding of this concept. No guarantee on the accuracy.ðŸ˜…</p>
          </div>

<p>The closure is a kind of intimidating concept for people new to javascript.<br>I think itâ€™s necessary to clarify some concept of execution context (EC) and scope before approaching â€˜closureâ€™ itself.</p>
<ul>
<li><p>Javascript has 3 types of scope (after ES6)</p>
<ul>
<li><p>block scope </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// ReferenceError: a is not defined</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Function scope</p>
</li>
<li><p>Global scope</p>
</li>
</ul>
</li>
</ul>
<p>  whenever youâ€™re trying to call/use a variable, the engine would find it <strong>along the scope chain</strong>. </p>
<p>  If the engine detects that a variable would not be called after the function execution context was removed from the call stack, it would junk the variable (<strong>garbage collecting</strong>) and free the memory.</p>
<ul>
<li><p>The [[scope]] is determined during <strong>function declarartion</strong>.</p>
<p><strong>All</strong> code is executed in their execution context: global EC or function EC. </p>
<p>EC can be abstracted as an object which includes <span class="label primary">variable object</span>, <span class="label success">scope chain</span>, and <span class="label warning"> this value</span>. </p>
</li>
<li><p><img src="/.com//closure-Page-2.svg" alt="closure-Page-2"></p>
</li>
<li><p>Whenever a function is called, its EC would be pushed to the top of the call stack. And all the VO are activated as activation objects. When all the code inside the function is executed or returned, the EC was destroyed. Next time if the same function is called again, a new EC would be created.</p>
</li>
<li><p>The function EC has two phases: creation phase and execution phase.</p>
</li>
<li><p>The creation phase is when the VO and â€˜thisâ€™ are created, and the scope chain is initialed by [[scope]]</p>
</li>
<li><p>The execution phase is when the value of each object/variable is assigned and determined.</p>
</li>
</ul>
<p><img src="/.com//closure.svg" alt="closure"></p>
<h3 id="A-classic-interview-question"><a href="#A-classic-interview-question" class="headerlink" title="A classic interview question:"></a>A classic interview question:</h3></p>
      <div class="post-button"><a class="btn" href="/2020/04/29/Closure/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>


<div id="pagination">
  <a class="extend prev" rel="prev" href="/"></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"></a>
</div>

<footer>
  <div>
    Copyright &copy; 2020<a href="/"> Brushes & Keys</a><br>Powered by <a
      href="https://hexo.io" target="_blank">Hexo</a> | Theme <a href="https://lx.js.org" target="_blank">Lx</a> |
    Modified by
    Nan Chen <br> Find me at <a href="https://github.com/southchen" target="_blank" rel="noopener">GitHub</a> <a
      href="https://instagram.com/divetothesea">Instagram</a> <a href="https://www.behance.net/southchen" target="_blank" rel="noopener">Behance</a>
    <br>
  </div>
</footer>

  </div>
</div>
</div>

  <button class="hamburger hamburger--arrow-r" type="button">
    <div class="hamburger-box">
      <div class="hamburger-inner"></div>
    </div>
  </button>
  <div class="menu visibility">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/"><img src="https://avatars0.githubusercontent.com/u/26827800?s=460&u=59259f6cb361b7fba376e3ae0c589ccc1639c8b4&v=4" alt="Nan Chen"/></a>
          </div>
        </div>
        <div class="row for-name">
          <p>Nan Chen</p>
          <span class="tagline">Not a Number ðŸ˜†</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>Home</a></li>
    <li><a href="/archives/"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
    
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-bookmark fa-fw"></i>Pages</span>
        <ul>
          <li><a href="/about">About</a></li>
        </ul>
    </li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-link fa-fw"></i>Friends</span>
        <ul>
          <li> <a href="https://lx.js.org" target="_blank">Theme-Lx</a></li>
        </ul>
    </li>
  </ul>
  </nav>
</div>

  <div class="gototop js-top">
    <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
  </div>
  <script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.easing.min.js"></script>
  <script>
    (function () {
      "use strict";
      var goToTop = function () {
        $(".js-gotop").on("click", function (event) {
          event.preventDefault();
          $("html, body").animate({
            scrollTop: $("html").offset().top
          }, 500, "easeInOutExpo");
          return false;
        });
        $(window).scroll(function () {
          var $win = $(window);
          if ($win.scrollTop() > 200) {
            $(".js-top").addClass("active");
          } else {
            $(".js-top").removeClass("active");
          }
        });
      };
      $(function () {
        goToTop();
      });
    }());

  </script>
  


</body>

</html>
